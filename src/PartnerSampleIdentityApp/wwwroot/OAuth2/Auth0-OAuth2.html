<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Auth0 Auth JS - Redirect</title>
    <!-- Auth0 SPA SDK from CDN -->
    <script src="https://cdn.auth0.com/js/auth0-spa-js/1.13/auth0-spa-js.production.js"></script>
    <link rel="stylesheet" href="/css/Styles.css" />
    <script type="text/javascript">
        // Update these for your Auth0 tenant
        let initDomain = "alaskaqa.us.auth0.com"; // e.g., your-tenant.auth0.com
        let initClientId = "Z44PoNZwqGlkByWjEZA5wXfYa1yiAZOZ"; // e.g., eyJvYXV0aDJDbGllbnRJZCI6I...
        let initRedirectUri = window.location.href;

        let auth0 = null;

        window.onload = async () => {
            document.getElementById("oauthDomain").setAttribute("value", initDomain);
            document.getElementById("oauthClientId").setAttribute("value", initClientId);
            document.getElementById("oauthRedirectUrl").setAttribute("value", initRedirectUri);

            await initializeAuth0Client(initDomain, initClientId, initRedirectUri);
        };

        // Bootstrap the Auth0 Client
        const initializeAuth0Client = async (domain, clientId, redirectUri) => {
            auth0 = await createAuth0Client({
                domain: domain,
                client_id: clientId,
                redirect_uri: redirectUri,
                scope: 'openid profile email'
            });

            // Handle authentication callback
            if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
                await auth0.handleRedirectCallback();
            }

            await updateUI();
        };

        const login = async () => {
            let newDomain = document.getElementById("oauthDomain").value;
            let newClientId = document.getElementById("oauthClientId").value;
            let newRedirectUri = document.getElementById("oauthRedirectUrl").value;

            await initializeAuth0Client(newDomain, newClientId, newRedirectUri);

            await auth0.loginWithRedirect();
        };

        const logout = () => {
            auth0.logout({
                returnTo: window.location.href
            });
        };

        const updateUI = async () => {
            const isAuthenticated = await auth0.isAuthenticated();
            const userData = document.getElementById('content-jwt');

            if (isAuthenticated) {
                const user = await auth0.getUser();
                userData.textContent = JSON.stringify(user, null, 2);
            } else {
                userData.textContent = 'User not authenticated';
            }
        };
    </script>
</head>
<body>
    <h1>Alaska Airlines</h1>
    <h2>Partner Authentication Example - Auth0 OAuth2</h2>
    <hr />
    <div>
        <pre id="content-jwt" align="left">User Details will populate here after login</pre>
    </div>
    <hr />
    <div id="uxActiveOptions">
        <form id="oauthConfigForm">
            <label for="oauthDomain">Enter OAuth domain URL:</label>
            <input
                    type="text"
                    id="oauthDomain"
                    name="oauthDomain"
                    required=""
                    value=""
                    size="50"
            />
            <br />
            <label for="oauthClientId">Enter OAuth client ID:</label>
            <input
                    type="text"
                    id="oauthClientId"
                    name="oauthClientId"
                    required=""
                    value=""
                    size="32"
            />
            <br />
            <label for="oauthRedirectUrl">Enter OAuth redirect URL:</label>
            <input
                    type="text"
                    id="oauthRedirectUrl"
                    name="oauthRedirectUrl"
                    required=""
                    value=""
                    size="50"
            />
            <br />

            <b>Functions:</b>
            <p><button onclick="login();">Login with Auth0</button></p>
            <p><button onclick="logout();">Logout</button></p>
        </form>
    </div>
</body>
</html>
