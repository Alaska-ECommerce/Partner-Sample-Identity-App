<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/Styles.css">
    <title>Okta Auth JS - Redirect</title>
    <!-- Latest CDN production Auth JS SDK-->
    <script src="https://global.oktacdn.com/okta-auth-js/7.7.0/okta-auth-js.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        // UPDATE THESE FOR YOUR OKTA TENANT
        var baseOktaURL = "https://alaska-test.oktapreview.com/"; // For example, https://dev-12345678.okta.com
        var appClientID = "0oah5f294dFeTFZNn1d7"; // For example, 0oa73hm5sh9jf6s5e1d6

        // Bootstrap the AuthJS Client
        const authClient = new OktaAuth({
            // Required Fields for OIDC client
            url: baseOktaURL,
            clientId: appClientID,
            redirectUri: "https://localhost:7271/OAuth2/OktaOAuth2.html", // or the redirect URI for your app
            issuer: baseOktaURL, // oidc
            scopes: ['openid', 'profile', 'email']
        });

        // Function to handle the redirection for authentication
        function redirectToOkta() {
            authClient.token.getWithRedirect({
                responseType: ['id_token']
            }).catch(err => console.error(err));
        }

        function signOut() {
            authClient.signOut();
            window.onload();
        }

        window.onload = function () {
            var jwtElement = document.getElementById('content-jwt');
            if (authClient.isLoginRedirect()) {
                // Parse token from redirect url
                console.log("Parse token from redirect url");
                authClient.token.parseFromUrl()
                    .then(data => {
                        const { idToken } = data.tokens;
                        // Display the Token
                        const str1 = document.createElement('p');
                        str1.id = 'jwt-details';
                        str1.innerHTML = `<b>${idToken.claims.email}</b> (email)<br /><b>${idToken.claims.sub}</b> (sub)<br /><br />Token Response:<br /><code style="word-wrap: break-word;">${JSON.stringify(idToken)}</code><br /><br/>Parsed from JWT<br />Client ID: <b>${authClient.options.clientId}</b><br />Issuer: <b>${authClient.options.issuer}</b>`;
                        jwtElement.appendChild(str1);
                    }).catch(err => console.error(err));
            }
            else {
                var jwtDetails = document.getElementById('jwt-details');
                if (jwtDetails) {
                    jwtElement.remove(jwtDetails);
                }
            }
        }
    </script>
</head>
<body>
    <h1>Alaska Airlines</h1>
    <h2>Partner Authentication Example - Okta OAuth2</h2>
    <hr />
    <div id="content-jwt">
        <h3>Jwt Details</h3>
    </div>
    <hr />
    <div id="uxActiveOptions">
        <b>Functions:</b>
        <p><button onclick="redirectToOkta();">Login with Okta</button></p>
        <p><button onclick="signOut();">Close Okta Session</button></p>
    </div>
</body>
</html>